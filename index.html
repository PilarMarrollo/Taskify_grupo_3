<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taskify Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="main-container">
      <!-- ===== HOME / DASHBOARD ===== -->
      <section class="screen active" id="home-section">
        <header class="top-header">
          <div>
            <h1 class="main-title">Tu progreso de hoy</h1>
            <p class="subtitle" id="current-date"></p>
          </div>
          <div class="progress-circle card">
            <div class="progress-number" id="progress-number">0%</div>
          </div>
        </header>

        <!-- OBJETIVO DIARIO -->
        <section class="daily-goal card">
          <h3>Objetivo diario</h3>
          <input
            type="number"
            id="daily-goal-input"
            placeholder="Ej: 5 tareas"
            min="1"
            aria-label="Objetivo diario"
          />
          <button id="save-goal" class="btn" aria-label="Guardar objetivo">
            Guardar
          </button>
          <p id="goal-display">Meta: 0 tareas</p>
        </section>

        <!-- RACHA DE PRODUCTIVIDAD -->
        <section class="streak-section card">
          <h3>üî• Racha de productividad</h3>
          <p>
            D√≠as consecutivos completando tareas:
            <span id="streak-count">0</span>
          </p>
        </section>

        <section class="metrics">
          <div class="metric-card card">
            <h3>Tareas totales</h3>
            <p id="total-tasks">0</p>
          </div>
          <div class="metric-card card">
            <h3>Completadas</h3>
            <p id="completed-tasks">0</p>
          </div>
          <div class="metric-card card">
            <h3>Pendientes</h3>
            <p id="pending-tasks">0</p>
          </div>
        </section>

        <section class="weekly-summary card">
          <h2>Resumen semanal</h2>
          <div class="chart-bars">
            <div class="bar" style="--value: 70%" data-day="Lun"></div>
            <div class="bar" style="--value: 50%" data-day="Mar"></div>
            <div class="bar" style="--value: 90%" data-day="Mi√©"></div>
            <div class="bar" style="--value: 40%" data-day="Jue"></div>
            <div class="bar" style="--value: 80%" data-day="Vie"></div>
          </div>
        </section>
      </section>

      <!-- ===== TASKS ===== -->
      <section class="screen" id="tasks-section">
        <div class="task-header">
          <h2>Mis tareas</h2>
          <select id="filter-tasks" aria-label="Filtrar tareas">
            <option value="all">Todas</option>
            <option value="pending">Pendientes</option>
            <option value="completed">Completadas</option>
          </select>
        </div>

        <div class="task-filter-category">
          <label for="filter-category">Categor√≠a:</label>
          <select id="filter-category" aria-label="Filtrar por categor√≠a">
            <option value="all">Todas</option>
            <option value="Trabajo">Trabajo</option>
            <option value="Estudio">Estudio</option>
            <option value="Personal">Personal</option>
          </select>
        </div>

        <ul id="task-list" class="task-list"></ul>

        <form
          id="add-task-form"
          class="add-task-form card"
          aria-label="Agregar tarea"
        >
          <input
            type="text"
            id="new-task-input"
            placeholder="Nueva tarea..."
            maxlength="100"
            autocomplete="off"
            required
            aria-label="Nueva tarea"
          />
          <select id="new-task-category" aria-label="Categoria tarea">
            <option value="General">General</option>
            <option value="Trabajo">Trabajo</option>
            <option value="Estudio">Estudio</option>
            <option value="Personal">Personal</option>
          </select>
          <input type="date" id="new-task-deadline" aria-label="Fecha l√≠mite" />
          <button type="submit" aria-label="Agregar tarea" class="btn">
            <i class="ph ph-plus"></i> Agregar
          </button>
        </form>
      </section>

      <!-- ===== PROFILE ===== -->
      <section class="screen" id="profile-section">
        <div class="profile-card">
          <div class="profile-avatar"><i class="ph ph-user"></i></div>
          <div class="profile-info">
            <h3>Grupo 3</h3>
            <p>grupo3@email.com</p>
          </div>
        </div>

        <div class="profile-details">
          <h4>Estad√≠sticas personales</h4>
          <p>Tareas completadas: <span id="stat-completed">0</span></p>
          <p>Tareas en curso: <span id="stat-pending">0</span></p>
        </div>

        <div class="theme-toggle">
          <h4>Tema visual</h4>
          <button id="toggle-theme" aria-pressed="false">
            Cambiar a modo oscuro üåô
          </button>
        </div>

        <div class="achievements">
          <h4>üèÖ Logros</h4>
          <ul id="achievements-list">
            <li>No hay logros a√∫n.</li>
          </ul>
        </div>
      </section>
    </main>

    <!-- ===== NAVBAR ===== -->
    <nav class="navbar" role="navigation" aria-label="Navegaci√≥n principal">
      <button class="nav-btn active" id="nav-home" aria-label="Ir a inicio">
        <i class="ph ph-house"></i>
        <span>Inicio</span>
      </button>
      <button class="nav-btn" id="nav-tasks" aria-label="Ir a tareas">
        <i class="ph ph-list-checks"></i>
        <span>Tareas</span>
      </button>
      <button class="nav-btn" id="nav-profile" aria-label="Ir a perfil">
        <i class="ph ph-user"></i>
        <span>Perfil</span>
      </button>
    </nav>

    <script>
      // ===== Utilities =====
      function getTasks() {
        try {
          return JSON.parse(localStorage.getItem("tasks") || "[]");
        } catch {
          return [];
        }
      }
      function saveTasks(tasks) {
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }
      function uid() {
        return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
      }

      // ===== Elements =====
      const homeSection = document.getElementById("home-section");
      const tasksSection = document.getElementById("tasks-section");
      const profileSection = document.getElementById("profile-section");

      const navHome = document.getElementById("nav-home");
      const navTasks = document.getElementById("nav-tasks");
      const navProfile = document.getElementById("nav-profile");

      const currentDateEl = document.getElementById("current-date");
      const progressNumberEl = document.getElementById("progress-number");

      const goalInput = document.getElementById("daily-goal-input");
      const saveGoalBtn = document.getElementById("save-goal");
      const goalDisplay = document.getElementById("goal-display");

      const streakDisplay = document.getElementById("streak-count");

      const taskList = document.getElementById("task-list");
      const addTaskForm = document.getElementById("add-task-form");
      const newTaskInput = document.getElementById("new-task-input");
      const newTaskCategory = document.getElementById("new-task-category");
      const newTaskDeadline = document.getElementById("new-task-deadline");
      const filterTasks = document.getElementById("filter-tasks");
      const filterCategory = document.getElementById("filter-category");

      const totalTasksEl = document.getElementById("total-tasks");
      const completedTasksEl = document.getElementById("completed-tasks");
      const pendingTasksEl = document.getElementById("pending-tasks");
      const statCompletedEl = document.getElementById("stat-completed");
      const statPendingEl = document.getElementById("stat-pending");
      const achievementsList = document.getElementById("achievements-list");
      const themeBtn = document.getElementById("toggle-theme");

      // ===== Navigation =====
      function activateButton(btn) {
        [navHome, navTasks, navProfile].forEach((b) =>
          b.classList.remove("active")
        );
        btn.classList.add("active");
      }

      function showSection(sectionEl) {
        [homeSection, tasksSection, profileSection].forEach((s) =>
          s.classList.remove("active")
        );
        sectionEl.classList.add("active");
      }

      navHome.addEventListener("click", () => {
        showSection(homeSection);
        activateButton(navHome);
      });
      navTasks.addEventListener("click", () => {
        showSection(tasksSection);
        activateButton(navTasks);
        renderTasks();
      });
      navProfile.addEventListener("click", () => {
        showSection(profileSection);
        activateButton(navProfile);
        renderProfileStats();
      });

      // ===== Initial UI values =====
      if (currentDateEl) {
        currentDateEl.textContent = new Date().toLocaleDateString("es-ES", {
          weekday: "long",
          day: "numeric",
          month: "long",
        });
      }

      // ===== Daily goal =====
      function loadGoal() {
        const saved = localStorage.getItem("dailyGoal");
        if (saved) {
          goalInput.value = saved;
          goalDisplay.textContent = `Meta: ${saved} tareas`;
        } else {
          goalDisplay.textContent = "Meta: 0 tareas";
        }
      }
      saveGoalBtn.addEventListener("click", () => {
        const g = Number(goalInput.value) || 0;
        localStorage.setItem("dailyGoal", g);
        goalDisplay.textContent = `Meta: ${g} tareas`;
        updateProgress();
        showToast("Objetivo guardado");
      });
      loadGoal();

      // ===== Streak (simple) =====
      function loadStreak() {
        const s = Number(localStorage.getItem("streak") || 0);
        streakDisplay.textContent = s;
      }
      loadStreak();

      // ===== Tasks: create / render / actions =====
      function createTaskObject({ text, category, deadline }) {
        return {
          _id: uid(),
          text,
          category: category || "General",
          deadline: deadline || "",
          completed: false,
          createdAt: new Date().toISOString(),
        };
      }

      function renderTasks() {
        const tasks = getTasks();
        taskList.innerHTML = "";

        const filter = filterTasks ? filterTasks.value : "all";
        const categoryFilter = filterCategory ? filterCategory.value : "all";

        const filtered = tasks.filter((t) => {
          if (filter === "completed" && !t.completed) return false;
          if (filter === "pending" && t.completed) return false;
          if (categoryFilter !== "all" && t.category !== categoryFilter)
            return false;
          return true;
        });

        if (!filtered.length) {
          const li = document.createElement("li");
          li.className = "empty";
          li.textContent = "No hay tareas a√∫n. ¬°Agreg√° tu primera!";
          taskList.appendChild(li);
        } else {
          filtered.forEach((task) => {
            const li = document.createElement("li");
            li.className = "task-item" + (task.completed ? " completed" : "");

            // checkbox
            const cb = document.createElement("input");
            cb.type = "checkbox";
            cb.className = "task-checkbox";
            cb.checked = !!task.completed;
            cb.setAttribute("aria-label", "Marcar completada");
            cb.addEventListener("change", () => toggleTaskById(task._id));

            // body (title + meta)
            const body = document.createElement("div");
            body.className = "task-body";

            const title = document.createElement("div");
            title.className = "task-title";
            title.textContent = task.text;

            // category badge
            const cat = document.createElement("span");
            cat.className = "task-category-badge";
            cat.textContent = task.category;
            title.appendChild(cat);

            // meta row
            const meta = document.createElement("div");
            meta.className = "task-meta";
            if (task.deadline) {
              const dl = document.createElement("span");
              dl.className = "task-deadline";
              dl.textContent = `‚è∞ ${task.deadline}`;
              meta.appendChild(dl);
            } else {
              const info = document.createElement("span");
              info.textContent = "";
              meta.appendChild(info);
            }

            body.appendChild(title);
            body.appendChild(meta);

            // actions
            const actions = document.createElement("div");
            actions.className = "task-actions";

            const completeBtn = document.createElement("button");
            completeBtn.className = "action-btn complete";
            completeBtn.title = task.completed
              ? "Marcar como pendiente"
              : "Marcar como completada";
            completeBtn.innerHTML = `<i class="ph ph-check"></i>`;
            completeBtn.addEventListener("click", () =>
              toggleTaskById(task._id)
            );

            const editBtn = document.createElement("button");
            editBtn.className = "action-btn edit";
            editBtn.title = "Editar";
            editBtn.innerHTML = `<i class="ph ph-pencil"></i>`;
            editBtn.addEventListener("click", () => editTaskById(task._id));

            const delBtn = document.createElement("button");
            delBtn.className = "action-btn delete";
            delBtn.title = "Eliminar";
            delBtn.innerHTML = `<i class="ph ph-trash"></i>`;
            delBtn.addEventListener("click", () => deleteTaskById(task._id));

            actions.appendChild(completeBtn);
            actions.appendChild(editBtn);
            actions.appendChild(delBtn);

            li.appendChild(cb);
            li.appendChild(body);
            li.appendChild(actions);

            taskList.appendChild(li);
          });
        }

        // update metrics
        const total = tasks.length;
        const completed = tasks.filter((t) => t.completed).length;
        const pending = total - completed;

        if (totalTasksEl) totalTasksEl.textContent = total;
        if (completedTasksEl) completedTasksEl.textContent = completed;
        if (pendingTasksEl) pendingTasksEl.textContent = pending;
        if (statCompletedEl) statCompletedEl.textContent = completed;
        if (statPendingEl) statPendingEl.textContent = pending;

        updateProgress();
        updateAchievements();
      }

      function toggleTaskById(id) {
        const tasks = getTasks();
        const idx = tasks.findIndex((t) => t._id === id);
        if (idx === -1) return;
        tasks[idx].completed = !tasks[idx].completed;
        saveTasks(tasks);
        // simple streak update
        if (tasks[idx].completed) {
          const lastMarked = localStorage.getItem("lastMarkedDay");
          const today = new Date().toISOString().slice(0, 10);
          if (lastMarked !== today) {
            const currentStreak = Number(localStorage.getItem("streak") || 0);
            localStorage.setItem("streak", String(currentStreak + 1));
            localStorage.setItem("lastMarkedDay", today);
            loadStreak();
          }
        }
        renderTasks();
      }

      function deleteTaskById(id) {
        if (!confirm("¬øEliminar esta tarea?")) return;
        const tasks = getTasks();
        const idx = tasks.findIndex((t) => t._id === id);
        if (idx === -1) return;
        tasks.splice(idx, 1);
        saveTasks(tasks);
        renderTasks();
        showToast("Tarea eliminada");
      }

      function editTaskById(id) {
        const tasks = getTasks();
        const idx = tasks.findIndex((t) => t._id === id);
        if (idx === -1) return;
        const t = tasks[idx];
        const newText = prompt("Editar tarea", t.text);
        if (newText === null) return;
        t.text = newText.trim() || t.text;
        saveTasks(tasks);
        renderTasks();
        showToast("Tarea actualizada");
      }

      // add-task form
      if (addTaskForm) {
        addTaskForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const text = newTaskInput.value.trim();
          if (!text) return;
          const category = newTaskCategory ? newTaskCategory.value : "General";
          const deadline = newTaskDeadline ? newTaskDeadline.value : "";
          const tasks = getTasks();
          tasks.unshift(createTaskObject({ text, category, deadline }));
          saveTasks(tasks);
          newTaskInput.value = "";
          if (newTaskDeadline) newTaskDeadline.value = "";
          renderTasks();
          showToast("Tarea creada");
        });
      }

      if (filterTasks) filterTasks.addEventListener("change", renderTasks);
      if (filterCategory)
        filterCategory.addEventListener("change", renderTasks);

      // progress & achievements
      function updateProgress() {
        const tasks = getTasks();
        const completed = tasks.filter((t) => t.completed).length;
        const goal = Number(localStorage.getItem("dailyGoal") || 0);
        let progress = 0;
        if (goal > 0)
          progress = Math.min(100, Math.round((completed / goal) * 100));
        else
          progress = Math.min(
            100,
            Math.round((completed / Math.max(1, tasks.length)) * 100)
          );
        if (progressNumberEl) progressNumberEl.textContent = `${progress}%`;
      }

      function updateAchievements() {
        const tasks = getTasks();
        const completed = tasks.filter((t) => t.completed).length;
        achievementsList.innerHTML = "";

        if (completed === 0) {
          achievementsList.innerHTML = "<li>Empieza tu primera tarea üí™</li>";
          return;
        }
        if (completed >= 10)
          achievementsList.innerHTML += "<li>üèÜ 10 tareas completadas</li>";
        if (completed >= 25)
          achievementsList.innerHTML += "<li>‚≠ê 25 tareas completadas</li>";
        if (completed < 10)
          achievementsList.innerHTML += `<li>¬°Sigue as√≠! Completadas: ${completed}</li>`;
      }

      // profile stats
      function renderProfileStats() {
        const tasks = getTasks();
        const completed = tasks.filter((t) => t.completed).length;
        const pending = tasks.length - completed;
        if (statCompletedEl) statCompletedEl.textContent = completed;
        if (statPendingEl) statPendingEl.textContent = pending;
        updateAchievements();
      }

      // theme toggle
      let darkMode = localStorage.getItem("darkMode") === "true";
      function applyTheme() {
        document.body.classList.toggle("dark", darkMode);
        if (themeBtn) {
          themeBtn.textContent = darkMode
            ? "Cambiar a modo claro ‚òÄÔ∏è"
            : "Cambiar a modo oscuro üåô";
          themeBtn.setAttribute("aria-pressed", darkMode ? "true" : "false");
        }
      }
      if (themeBtn) {
        themeBtn.addEventListener("click", () => {
          darkMode = !darkMode;
          localStorage.setItem("darkMode", darkMode ? "true" : "false");
          applyTheme();
        });
      }
      applyTheme();

      // toast
      let toastTimer = null;
      function showToast(text, ms = 1700) {
        let toast = document.querySelector(".toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.className = "toast";
          document.body.appendChild(toast);
        }
        toast.textContent = text;
        toast.classList.add("show");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => {
          toast.classList.remove("show");
        }, ms);
      }

      // init
      document.addEventListener("DOMContentLoaded", () => {
        const tasks = getTasks();
        let changed = false;
        for (let t of tasks) {
          if (!t._id) {
            t._id = uid();
            changed = true;
          }
        }
        if (changed) saveTasks(tasks);

        loadGoal();
        loadStreak();
        renderTasks();
      });
    </script>
  </body>
</html>
